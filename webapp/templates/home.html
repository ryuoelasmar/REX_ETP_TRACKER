{% extends "base.html" %}
{% block title %}REX Financial Intelligence Hub{% endblock %}
{% block content %}
<div class="home-hero">
  <h1 class="home-title">REX Financial Intelligence Hub</h1>
  <p class="home-tagline">
    REX's central intelligence platform â€” market positioning, SEC filing activity, and product analytics across the full ETP universe.
  </p>
  <div class="hero-kpi-strip">
    <div class="hero-kpi-box" id="kpi-aum">
      <div class="hero-kpi-value" data-kpi="rex_aum">--</div>
      <div class="hero-kpi-change" id="kpi-aum-change"></div>
      <div class="hero-kpi-label">REX AUM</div>
    </div>
    <div class="hero-kpi-box" id="kpi-flows">
      <div class="hero-kpi-value" data-kpi="weekly_flows">--</div>
      <div class="hero-kpi-label">Weekly Flows</div>
    </div>
    <div class="hero-kpi-box" id="kpi-filings">
      <div class="hero-kpi-value" data-kpi="todays_filings">--</div>
      <div class="hero-kpi-label">Today's Filings</div>
    </div>
    <div class="hero-kpi-box" id="kpi-institutions">
      <div class="hero-kpi-value" data-kpi="institutions_count">--</div>
      <div class="hero-kpi-label">Institutions Tracked</div>
    </div>
  </div>
</div>

<div class="home-section">
  <div class="home-section-title">Market Intelligence</div>
  <div class="home-grid">
    <a href="/market/rex" class="home-card home-card--market">
      <div class="home-card-tag">Market</div>
      <div class="home-card-title">REX View</div>
      <div class="home-card-desc">REX branded suite performance, AUM by suite, and competitive positioning.</div>
    </a>
    <a href="/market/category" class="home-card home-card--market">
      <div class="home-card-tag">Market</div>
      <div class="home-card-title">Category View</div>
      <div class="home-card-desc">Deep-dive into AUM, flows, and treemap across 8 ETP categories.</div>
    </a>
    <a href="/market/issuer" class="home-card home-card--market">
      <div class="home-card-tag">Market</div>
      <div class="home-card-title">Issuer Analysis</div>
      <div class="home-card-desc">Rank and compare issuers by AUM, flows, market share, and 12-month trends.</div>
    </a>
    <a href="/market/underlier" class="home-card home-card--market">
      <div class="home-card-tag">Market</div>
      <div class="home-card-title">Underlier</div>
      <div class="home-card-desc">Analyze the full ETP landscape by underlying asset.</div>
    </a>
    <a href="/market/calendar" class="home-card home-card--market">
      <div class="home-card-tag">Market</div>
      <div class="home-card-title">Calendar</div>
      <div class="home-card-desc">Fund launch calendar, upcoming effective dates, and recent activity.</div>
    </a>
    <a href="/market/compare" class="home-card home-card--market">
      <div class="home-card-tag">Market</div>
      <div class="home-card-title">Compare</div>
      <div class="home-card-desc">Side-by-side product comparison across AUM, flows, and returns.</div>
    </a>
  </div>
</div>

<div class="home-section">
  <div class="home-section-title">SEC Filings</div>
  <div class="home-grid">
    <a href="/dashboard" class="home-card home-card--filing">
      <div class="home-card-tag">Filings</div>
      <div class="home-card-title">Trust Dashboard</div>
      <div class="home-card-desc">Monitor SEC filings across 194 trusts. Track 485BPOS, 485BXT, and 497 forms.</div>
    </a>
    <a href="/funds/" class="home-card home-card--filing">
      <div class="home-card-tag">Filings</div>
      <div class="home-card-title">Fund Lookup</div>
      <div class="home-card-desc">Search 7,000+ ETF funds by ticker, name, or trust. Filter by status.</div>
    </a>
    <a href="/filings/" class="home-card home-card--filing">
      <div class="home-card-tag">Filings</div>
      <div class="home-card-title">Filing Explorer</div>
      <div class="home-card-desc">Search and browse all SEC filings with date, form type, and text filters.</div>
    </a>
  </div>
</div>

<div class="home-section">
  <div class="home-section-title">Product Development</div>
  <div class="home-grid">
    <a href="/screener/" class="home-card home-card--product">
      <div class="home-card-tag">Product</div>
      <div class="home-card-title">Competitive Landscape</div>
      <div class="home-card-desc">3x/4x/5x filing matrix across all issuers. REX exclusives, gaps, and scorecard.</div>
    </a>
    <a href="/screener/3x-analysis" class="home-card home-card--product">
      <div class="home-card-tag">Product</div>
      <div class="home-card-title">3x/4x Analysis</div>
      <div class="home-card-desc">Bloomberg-powered filing recommendations, tiered by demand and risk.</div>
    </a>
    <a href="/screener/evaluate" class="home-card home-card--product">
      <div class="home-card-tag">Product</div>
      <div class="home-card-title">Candidate Evaluator</div>
      <div class="home-card-desc">Side-by-side scoring comparison for specific tickers.</div>
    </a>
  </div>
</div>

<div class="home-section">
  <div class="home-section-title">Admin &amp; Data</div>
  <div class="home-grid">
    <a href="/downloads/" class="home-card home-card--ops">
      <div class="home-card-tag">Ops</div>
      <div class="home-card-title">Data Downloads</div>
      <div class="home-card-desc">Export fund status, filing history, and pipeline CSVs for any trust.</div>
    </a>
    <a href="/digest/subscribe" class="home-card home-card--ops">
      <div class="home-card-tag">Ops</div>
      <div class="home-card-title">Email Digest</div>
      <div class="home-card-desc">Subscribe to daily filing digest emails for the REX team.</div>
    </a>
  </div>
</div>

<div class="home-contact">
  <p>Questions or feedback? Contact <a href="mailto:relasmar@rexfin.com">relasmar@rexfin.com</a></p>
</div>

<script>
(function() {
  fetch('/api/v1/home-kpis')
    .then(function(r) { return r.ok ? r.json() : Promise.reject(r.status); })
    .then(function(d) {
      var aumEl = document.querySelector('[data-kpi="rex_aum"]');
      if (aumEl && d.rex_aum) aumEl.textContent = d.rex_aum;

      var changeEl = document.getElementById('kpi-aum-change');
      if (changeEl && d.rex_aum_change_pct != null && d.rex_aum_change_pct !== 0) {
        var pct = d.rex_aum_change_pct;
        var sign = pct > 0 ? '+' : '';
        changeEl.textContent = sign + pct.toFixed(1) + '% MoM';
        changeEl.classList.add(pct >= 0 ? 'hero-kpi-change--up' : 'hero-kpi-change--down');
      }

      var flowsEl = document.querySelector('[data-kpi="weekly_flows"]');
      if (flowsEl && d.weekly_flows) flowsEl.textContent = d.weekly_flows;

      var filingsEl = document.querySelector('[data-kpi="todays_filings"]');
      if (filingsEl && d.todays_filings != null) filingsEl.textContent = d.todays_filings;

      var instEl = document.querySelector('[data-kpi="institutions_count"]');
      if (instEl && d.institutions_count != null) {
        instEl.textContent = d.institutions_count.toLocaleString();
      }
    })
    .catch(function() { /* leave "--" placeholders on error */ });
})();
</script>
{% endblock %}
